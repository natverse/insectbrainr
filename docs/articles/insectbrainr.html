<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>insectbrainr • insectbrainr</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="insectbrainr">
<meta property="og:description" content="insectbrainr">
<meta property="og:image" content="/logo.svg">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">insectbrainr</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.1.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../articles/insectbrainr.html">Get started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/natverse/insectbrainr/">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>insectbrainr</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/natverse/insectbrainr/blob/master/vignettes/insectbrainr.Rmd"><code>vignettes/insectbrainr.Rmd</code></a></small>
      <div class="hidden name"><code>insectbrainr.Rmd</code></div>

    </div>

    
    
<blockquote>
<p>“INSECTS possess a nervous system that is incredibly complex and differentiated, and whose sophistication attains ultramicroscopic levels … Certainly, the grey substance [of the brain of vertebrates] has increased considerably in mass, but when one compares its structure with that of the brain of Apidae or Libellulidae, it looks as excessively coarse and rudimentary. It is like pretending to match the rough merit of a standing wall clock with that of a pocket watch, a marvel of delicacy and precision. As usually, the genius of life shines more in the construction of smaller than larger master pieces.” (<a href="https://www.britannica.com/biography/Santiago-Ramon-y-Cajal">SR y Cajal</a>)</p>
</blockquote>
<div id="inspecting-insect-brains" class="section level1">
<h1 class="hasAnchor">
<a href="#inspecting-insect-brains" class="anchor"></a>Inspecting insect brains</h1>
<p>It’s not often that you get to see brains from a range of different beautiful insects. They look quite funky. I wonder how the size of their sub-domains change with the size of the brain itself? We can use <code>neuromorphr</code> alongside its dependency, <code>nat</code> to pull and plot these brains, which are hosted and curated by <a href="https://insectbraindb.org/app/">insectbraindb.org</a></p>
<div id="find-brains" class="section level2">
<h2 class="hasAnchor">
<a href="#find-brains" class="anchor"></a>Find brains</h2>
<p>First, we need to find the brains hosted on <a href="https://insectbraindb.org/app/">insectbraindb.org</a>. These are required, because we need at least one of these two bits of information in order to read neurons from the repository.</p>
<p>To find these items, let us search the repository for neurons from the two groups of animal in which we are interested:</p>
<div class="sourceCode" id="cb1"><html><body><pre class="r"><span class="co"># Load package</span>
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">neuromorphr</span>)
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">nat</span>)

<span class="co"># Righto, which species does the database host?</span>
<span class="no">species_info</span> <span class="kw">=</span> <span class="fu"><a href="../reference/insectbraindb_info.html">insectbraindb_species_info</a></span>()
<span class="no">insect.species</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/unique.html">unique</a></span>(<span class="no">species_info</span>$<span class="no">scientific_name</span>)

<span class="co"># Okay, so a bunch of bees, wasps, moths, beetles and 'worms'</span>
<span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/unique.html">unique</a></span>(<span class="no">species_info</span>$<span class="no">common_name</span>))</pre></body></html></div>
</div>
<div id="read-brains" class="section level2">
<h2 class="hasAnchor">
<a href="#read-brains" class="anchor"></a>Read brains</h2>
<p>Armed with this information, we can now read the the brains as <code>nat</code> package <code>hxsurf</code> objects. You can find a detailed explanation of this data format, and its basic manipulation with <code>nat</code> tools, <a href="https://jefferis.github.io/nat/">here</a>. Importantly, we can sub-divide a <code>hxsurf</code> brain by its constituent regions, in this case, neuropils, for visualisation and analysis.</p>
<div class="sourceCode" id="cb2"><html><body><pre class="r"><span class="co"># Let's try to read every brain the repository has</span>
<span class="no">insect.brains</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span>()
<span class="kw">for</span>(<span class="no">insect</span> <span class="kw">in</span> <span class="no">insect.species</span>){
  <span class="fu"><a href="https://rdrr.io/r/base/message.html">message</a></span>(<span class="st">"Pulling "</span>, <span class="no">insect</span>, <span class="st">" brain mesh"</span>)
  <span class="kw">for</span>(<span class="no">sex</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"UNKNOWN"</span>, <span class="st">"MALE"</span>, <span class="st">"FEMALE"</span>)){
    <span class="fu"><a href="https://rdrr.io/r/base/message.html">message</a></span>(<span class="no">sex</span>)
    <span class="no">insect.brain</span> <span class="kw">=</span> <span class="fu"><a href="../reference/insectbraindb_read_brain.html">insectbraindb_read_brain</a></span>(<span class="kw">species</span> <span class="kw">=</span> <span class="no">insect</span>, <span class="kw">brain.sex</span>  <span class="kw">=</span> <span class="no">sex</span>, <span class="kw">progress</span> <span class="kw">=</span> <span class="fl">TRUE</span>)
    <span class="no">insect.sex</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span>(<span class="no">insect</span>, <span class="no">sex</span>, <span class="kw">sep</span> <span class="kw">=</span> <span class="st">" "</span>)
    <span class="kw">if</span>(!<span class="fu"><a href="https://rdrr.io/r/base/NULL.html">is.null</a></span>(<span class="no">insect.brain</span>)){
      <span class="no">insect.brains</span><span class="kw">[[</span><span class="no">insect.sex</span>]] <span class="kw">=</span> <span class="no">insect.brain</span>
    }
  }
}
<span class="co"># You will notice that we failed to read two brains there. It seems there is no reconstruction yet for Bombus terrestris, and that the Helicoverpa armigera requires a user with an account on insectbraindb.org </span>

<span class="co"># Because you donwload .obj files to the same temporary directory, which persists as long as the R session, re-reading the same brain again is quicker - because you have already downloaded the underlying files! Try re-running the above code in your R console to see (Markdown behaviour can be different).</span>

<span class="co"># Let's also chuck in a Drosophila melanogaster brain for good measure </span>
<span class="kw">if</span>(!<span class="fu"><a href="https://rdrr.io/r/base/library.html">require</a></span>(<span class="st">'devtools'</span>)) <span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html">install.packages</a></span>(<span class="st">"devtools"</span>)
<span class="kw">if</span>(!<span class="fu"><a href="https://rdrr.io/r/base/library.html">require</a></span>(<span class="st">'nat.flybrains'</span>)) <span class="kw pkg">devtools</span><span class="kw ns">::</span><span class="fu"><a href="https://devtools.r-lib.org//reference/remote-reexports.html">install_github</a></span>(<span class="st">"jefferislab/nat.flybrains"</span>)
<span class="no">JFRC2NP.surf</span> <span class="kw">=</span> <span class="kw pkg">nat.flybrains</span><span class="kw ns">::</span><span class="no"><a href="https://rdrr.io/pkg/nat.flybrains/man/JFRC2NP.surf.html">JFRC2NP.surf</a></span>
<span class="no">JFRC2NP.surf</span>$<span class="no">scientific_name</span> <span class="kw">=</span> <span class="st">"Drosophila melanogaster"</span>
<span class="no">JFRC2NP.surf</span>$<span class="no">common_name</span> <span class="kw">=</span> <span class="st">"Vinegar fly"</span> <span class="co"># Not fruit fly</span>
<span class="no">JFRC2NP.surf</span>$<span class="no">sex</span> <span class="kw">=</span> <span class="st">"UNKNOWN"</span> <span class="co"># Actually, it is intersex</span>
<span class="no">insect.brains</span><span class="kw">[[</span><span class="st">"Drosophila melanogaster UNKNOWN"</span>]] <span class="kw">=</span> <span class="no">JFRC2NP.surf</span>
<span class="co"># It is the best of the insects after all</span></pre></body></html></div>
</div>
<div id="plot-brains" class="section level2">
<h2 class="hasAnchor">
<a href="#plot-brains" class="anchor"></a>Plot brains</h2>
<p>Now we have a fair few brains. They can’t be plotted together really, at least not as 3D objects. But we can write some code to scan through them and have a quick looksee</p>
<div class="sourceCode" id="cb3"><html><body><pre class="r"><span class="co"># Hold right click to pan</span>
<span class="kw pkg">nat</span><span class="kw ns">::</span><span class="fu"><a href="https://rdrr.io/pkg/nat/man/nopen3d.html">nopen3d</a></span>(<span class="kw">userMatrix</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/structure.html">structure</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">0.999986588954926</span>, -<span class="fl">0.00360279157757759</span>,
-<span class="fl">0.00371213257312775</span>, <span class="fl">0</span>, -<span class="fl">0.00464127957820892</span>, -<span class="fl">0.941770493984222</span>,
-<span class="fl">0.336223870515823</span>, <span class="fl">0</span>, -<span class="fl">0.00228461623191833</span>, <span class="fl">0.336236596107483</span>,
-<span class="fl">0.941774606704712</span>, <span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">1</span>), <span class="kw">.Dim</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">4L</span>, <span class="fl">4L</span>)), <span class="kw">zoom</span> <span class="kw">=</span> <span class="fl">0.600000023841858</span>,
    <span class="kw">windowRect</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">1460L</span>, <span class="fl">65L</span>, <span class="fl">3229L</span>, <span class="fl">1083L</span>))
<span class="kw">for</span>(<span class="no">ib</span> <span class="kw">in</span> <span class="no">insect.brains</span>){
  <span class="fu">clear3d</span>()
  <span class="fu"><a href="https://rdrr.io/r/base/message.html">message</a></span>(<span class="no">ib</span>$<span class="no">scientific_name</span>, <span class="st">" the "</span>, <span class="no">ib</span>$<span class="no">common_name</span>)
  <span class="fu"><a href="https://rdrr.io/pkg/nat/man/plot3d.html">plot3d</a></span>(<span class="no">ib</span>)
  <span class="no">progress</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/readline.html">readline</a></span>(<span class="kw">prompt</span> <span class="kw">=</span> <span class="st">"Press any key for next brain ... "</span>)
}</pre></body></html></div>
</div>
<div id="plot-antennal-lobes" class="section level2">
<h2 class="hasAnchor">
<a href="#plot-antennal-lobes" class="anchor"></a>Plot antennal lobes</h2>
<p>We can also subset these brains by a particular brain area. Everyone likes the antennal lobe, maybe it’s the best studied bit of insect neuro-anatomy. So let’s have a gander at that.</p>
<div class="sourceCode" id="cb4"><html><body><pre class="r"><span class="co"># Let's have a look at how standardised the neuropil names are, across these species</span>
<span class="no">neuropils</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html">lapply</a></span>(<span class="no">insect.brains</span>, <span class="kw">function</span>(<span class="no">brain</span>) <span class="fu"><a href="https://rdrr.io/r/base/sort.html">sort</a></span>(<span class="no">brain</span>$<span class="no">neuropil_full_names</span>))
<span class="no">als</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html">sapply</a></span>(<span class="no">neuropils</span>, <span class="kw">function</span>(<span class="no">np</span>) <span class="st">"Antennal Lobe"</span><span class="kw">%in%</span><span class="no">np</span>)
<span class="no">als</span>
<span class="co"># Okay, so we have it in all, and indeed it has a capital A and a capital L</span>

<span class="co"># Brains that contain a antennal lobe neuropil object</span>
<span class="no">with.al</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html">sapply</a></span>(<span class="no">insect.brains</span>, <span class="kw">function</span>(<span class="no">ib</span>) <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/grep.html">grepl</a></span>(<span class="st">"^Antennal Lobe$"</span>, <span class="no">ib</span>$<span class="no">neuropil_full_names</span>))<span class="kw">&gt;</span><span class="fl">0</span>)
<span class="no">insect.brains.with.al</span> <span class="kw">=</span> <span class="no">insect.brains</span>[<span class="no">with.al</span>]
<span class="no">insect.brains.with.al</span><span class="kw">[[</span><span class="st">"Drosophila melanogaster"</span>]] <span class="kw">=</span> <span class="no">JFRC2NP.surf</span> <span class="co"># Got dropped out, as it does not have all the entries of a insectbraindb read brain</span>

<span class="co"># Hold right click to pan</span>
<span class="kw pkg">nat</span><span class="kw ns">::</span><span class="fu"><a href="https://rdrr.io/pkg/nat/man/nopen3d.html">nopen3d</a></span>(<span class="kw">userMatrix</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/structure.html">structure</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">0.999986588954926</span>, -<span class="fl">0.00360279157757759</span>,
-<span class="fl">0.00371213257312775</span>, <span class="fl">0</span>, -<span class="fl">0.00464127957820892</span>, -<span class="fl">0.941770493984222</span>,
-<span class="fl">0.336223870515823</span>, <span class="fl">0</span>, -<span class="fl">0.00228461623191833</span>, <span class="fl">0.336236596107483</span>,
-<span class="fl">0.941774606704712</span>, <span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">1</span>), <span class="kw">.Dim</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">4L</span>, <span class="fl">4L</span>)), <span class="kw">zoom</span> <span class="kw">=</span> <span class="fl">0.600000023841858</span>,
    <span class="kw">windowRect</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">1460L</span>, <span class="fl">65L</span>, <span class="fl">3229L</span>, <span class="fl">1083L</span>))
<span class="kw">for</span>(<span class="no">ib</span> <span class="kw">in</span> <span class="no">insect.brains.with.al</span>){
  <span class="fu">clear3d</span>()
  <span class="fu"><a href="https://rdrr.io/r/base/message.html">message</a></span>(<span class="no">ib</span>$<span class="no">scientific_name</span>, <span class="st">" the "</span>, <span class="no">ib</span>$<span class="no">common_name</span>)
  <span class="fu"><a href="https://rdrr.io/pkg/nat/man/plot3d.html">plot3d</a></span>(<span class="fu"><a href="https://rdrr.io/pkg/nat/man/subset.html">subset</a></span>(<span class="no">ib</span>, <span class="st">"^AL_left|^AL_right|^AL_noside|^AL_R$|^AL_L$"</span>), <span class="kw">col</span> <span class="kw">=</span> <span class="st">"red"</span>)
  <span class="co">#plot3d(ib, col = "lightgrey", alpha = 0.3)</span>
  <span class="no">progress</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/readline.html">readline</a></span>(<span class="kw">prompt</span> <span class="kw">=</span> <span class="st">"Press any key for next brain ... "</span>)
}</pre></body></html></div>
</div>
<div id="comparing-neuropils" class="section level2">
<h2 class="hasAnchor">
<a href="#comparing-neuropils" class="anchor"></a>Comparing neuropils</h2>
<p>Fab. Now what we really might like to know if how the volume of the antennal lobe differs across species. So let’s put our analysis hat on and take a look at that.</p>
<div class="sourceCode" id="cb5"><html><body><pre class="r"><span class="co"># There are a few ways of calculating a volume for a mesh. I am going to be lazy and use the package alphashape3d.</span>
<span class="co"># We will also use pbapply, because volume calculation can take some time, and it is nice to know how things are going</span>
<span class="kw">if</span>(!<span class="fu"><a href="https://rdrr.io/r/base/library.html">require</a></span>(<span class="st">'alphashape3d'</span>)) <span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html">install.packages</a></span>(<span class="st">"alphashape3d"</span>)
<span class="kw">if</span>(!<span class="fu"><a href="https://rdrr.io/r/base/library.html">require</a></span>(<span class="st">'pbapply'</span>)) <span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html">install.packages</a></span>(<span class="st">"pbapply"</span>)

<span class="co"># Create function to calculate volume</span>
<span class="no">calculate_volume</span> <span class="kw">&lt;-</span> <span class="kw">function</span>(<span class="no">brain</span>, <span class="no">neuropil</span> <span class="kw">=</span> <span class="kw">NULL</span>, <span class="no">alpha</span> <span class="kw">=</span> <span class="fl">30</span>){
  <span class="kw">if</span>(<span class="fu"><a href="https://rdrr.io/r/base/NULL.html">is.null</a></span>(<span class="no">neuropil</span>)){
    <span class="no">points</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/unique.html">unique</a></span>(<span class="kw pkg">nat</span><span class="kw ns">::</span><span class="fu"><a href="https://rdrr.io/pkg/nat/man/xyzmatrix.html">xyzmatrix</a></span>(<span class="no">brain</span>))
  }<span class="kw">else</span>{
    <span class="no">points</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/unique.html">unique</a></span>(<span class="kw pkg">nat</span><span class="kw ns">::</span><span class="fu"><a href="https://rdrr.io/pkg/nat/man/xyzmatrix.html">xyzmatrix</a></span>(<span class="fu"><a href="https://rdrr.io/pkg/nat/man/subset.html">subset</a></span>(<span class="no">brain</span>, <span class="no">neuropil</span>)))
  }
  <span class="no">a</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/pkg/alphashape3d/man/ashape3d.html">ashape3d</a></span>(<span class="no">points</span>, <span class="kw">alpha</span> <span class="kw">=</span> <span class="no">alpha</span>, <span class="kw">pert</span> <span class="kw">=</span> <span class="fl">TRUE</span>)
  <span class="fu"><a href="https://rdrr.io/pkg/alphashape3d/man/volume_ashape3d.html">volume_ashape3d</a></span>(<span class="no">a</span>)
}

<span class="co"># Get the volumes for the whole brain</span>
<span class="no">insect.brain.volumes</span> <span class="kw">=</span> <span class="kw pkg">pbapply</span><span class="kw ns">::</span><span class="fu"><a href="https://rdrr.io/pkg/pbapply/man/pbapply.html">pbsapply</a></span>(<span class="no">insect.brains.with.al</span>, <span class="no">calculate_volume</span>, <span class="kw">neuropil</span> <span class="kw">=</span> <span class="kw">NULL</span>)

<span class="co"># Get the volumes for just the antennal lobe</span>
<span class="no">insect.al.volumes</span> <span class="kw">=</span> <span class="kw pkg">pbapply</span><span class="kw ns">::</span><span class="fu"><a href="https://rdrr.io/pkg/pbapply/man/pbapply.html">pbsapply</a></span>(<span class="no">insect.brains.with.al</span>, <span class="no">calculate_volume</span>, <span class="kw">neuropil</span> <span class="kw">=</span> <span class="st">"^AL_left|^AL_right|^AL_noside|^AL_R$|^AL_L$"</span>)

<span class="co"># Hmm, that took a while</span></pre></body></html></div>
<p>We can then use the wonderful ggplot2 package to visualise this data</p>
<div class="sourceCode" id="cb6"><html><body><pre class="r"><span class="co"># Assemble data.frame</span>
<span class="no">species.with.al</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html">sapply</a></span>(<span class="no">insect.brains.with.al</span>, <span class="kw">function</span>(<span class="no">x</span>) <span class="no">x</span>$<span class="no">common_name</span>)
<span class="no">sex.with.al</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/unlist.html">unlist</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/lapply.html">sapply</a></span>(<span class="no">insect.brains.with.al</span>, <span class="kw">function</span>(<span class="no">x</span>) <span class="no">x</span>$<span class="no">sex</span><span class="kw">[[</span><span class="fl">1</span>]]))
<span class="no">df</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span>(<span class="kw">species</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="no">species.with.al</span>, <span class="no">species.with.al</span>),
                <span class="kw">sex</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="no">sex.with.al</span>, <span class="no">sex.with.al</span>),
                <span class="kw">volume</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="no">insect.brain.volumes</span>, <span class="no">insect.al.volumes</span>),
                <span class="kw">neuropil</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span>(<span class="st">"whole"</span>,<span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span>(<span class="no">insect.brain.volumes</span>)),<span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span>(<span class="st">"AL"</span>,<span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span>(<span class="no">insect.al.volumes</span>)))
)

<span class="co"># Plot!</span>
<span class="kw">if</span>(!<span class="fu"><a href="https://rdrr.io/r/base/library.html">require</a></span>(<span class="st">'ggplot2'</span>)) <span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html">install.packages</a></span>(<span class="st">"ggplot2"</span>)
<span class="kw pkg">ggplot2</span><span class="kw ns">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span>(<span class="no">df</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span>(<span class="kw">x</span><span class="kw">=</span><span class="no">species</span>, <span class="kw">y</span><span class="kw">=</span><span class="no">volume</span>, <span class="kw">color</span> <span class="kw">=</span> <span class="no">neuropil</span>, <span class="kw">group</span> <span class="kw">=</span> <span class="no">neuropil</span>, <span class="kw">shape</span><span class="kw">=</span><span class="no">sex</span>)) +
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_jitter.html">geom_jitter</a></span>(<span class="kw">position</span><span class="kw">=</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/position_dodge.html">position_dodge</a></span>(<span class="fl">0.2</span>))+
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_classic</a></span>()

<span class="co"># Hmm, let's see total brain volume against antennal lobe volume</span>
<span class="no">df2</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span>(<span class="kw">species</span> <span class="kw">=</span> <span class="no">species.with.al</span>,
                <span class="kw">sex</span> <span class="kw">=</span> <span class="no">sex.with.al</span>,
                <span class="kw">volume</span> <span class="kw">=</span> <span class="no">insect.brain.volumes</span>,
                <span class="kw">al.volume</span> <span class="kw">=</span> <span class="no">insect.al.volumes</span>
)
<span class="kw pkg">ggplot2</span><span class="kw ns">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span>(<span class="no">df2</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span>(<span class="kw">x</span><span class="kw">=</span><span class="no">volume</span>, <span class="kw">y</span><span class="kw">=</span><span class="no">al.volume</span>, <span class="kw">color</span> <span class="kw">=</span> <span class="no">species</span>)) +
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span>() +
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_smooth.html">geom_smooth</a></span>(<span class="kw">data</span> <span class="kw">=</span> <span class="no">df2</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span>(<span class="kw">x</span><span class="kw">=</span><span class="no">volume</span>, <span class="kw">y</span><span class="kw">=</span><span class="no">al.volume</span>, <span class="kw">color</span> <span class="kw">=</span> <span class="st">"black"</span>), <span class="kw">method</span><span class="kw">=</span><span class="no">lm</span>, <span class="kw">se</span> <span class="kw">=</span> <span class="fl">FALSE</span>)+
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_classic</a></span>()</pre></body></html></div>
<p>Also note, that some of these brains, such as that for Agrotis segetum, are not actually complete seemingly.</p>
<p>It is hard to interpret this sort of result. Perhaps we are better served by trying to see an olfactory - vision trade-off, and compare the AL size with the size of the optic lobes? The optic lobes are a bit more complicated, the consist of:</p>
<ul>
<li>Accessory medulla</li>
<li>Dorsal rim medulla</li>
<li>Lamina</li>
<li>Accessory lamina</li>
<li>Dorsal lamina</li>
<li>Ventral lamina</li>
<li>Lobula complex</li>
<li>Anterior lobula</li>
<li>Dorsal lobula</li>
<li>Inner lobula</li>
<li>Lobula</li>
<li>Lobula plate</li>
<li>Outer lobula</li>
<li>Medulla</li>
<li>Inner medulla</li>
<li>Outer medulla</li>
</ul>
<p>So a bit more complicated. But to be fair, the antennal lobe has plenty of glomeruli (~50 in Drosophila, &gt;500 in ants) and those are not drawn out in these brain models.</p>
<div class="sourceCode" id="cb7"><html><body><pre class="r"><span class="co"># Which insects have which major optic neuropils?</span>
<span class="no">lamina</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html">sapply</a></span>(<span class="no">neuropils</span>, <span class="kw">function</span>(<span class="no">np</span>) <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/grep.html">grepl</a></span>(<span class="st">"Lamina"</span>, <span class="no">np</span>)))
<span class="no">lamina</span>
<span class="no">lobula</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html">sapply</a></span>(<span class="no">neuropils</span>, <span class="kw">function</span>(<span class="no">np</span>) <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/grep.html">grepl</a></span>(<span class="st">"Lobula"</span>, <span class="no">np</span>)))
<span class="no">lobula</span>
<span class="no">medulla</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html">sapply</a></span>(<span class="no">neuropils</span>, <span class="kw">function</span>(<span class="no">np</span>) <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/grep.html">grepl</a></span>(<span class="st">"Medulla"</span>, <span class="no">np</span>)))
<span class="no">medulla</span>
<span class="co"># Looks like the lamina is missing from many of these brains. We'll combine lobula and medulla volumes for our calculation</span>

<span class="co"># Brains that contain a optic lobe neuropil objects, though not necessarily all of them</span>
<span class="no">with.optic</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html">sapply</a></span>(<span class="no">insect.brains</span>, <span class="kw">function</span>(<span class="no">ib</span>) <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/grep.html">grepl</a></span>(<span class="st">"^Lobula|^Medulla"</span>, <span class="no">ib</span>$<span class="no">neuropil_full_names</span>))<span class="kw">&gt;</span><span class="fl">0</span>)
<span class="no">insect.brains.with.optic</span> <span class="kw">=</span> <span class="no">insect.brains</span>[<span class="no">with.optic</span>]

<span class="co"># Calculate the neuropil volumes</span>
<span class="no">insect.optic.volumes</span> <span class="kw">=</span> <span class="kw pkg">pbapply</span><span class="kw ns">::</span><span class="fu"><a href="https://rdrr.io/pkg/pbapply/man/pbapply.html">pbsapply</a></span>(<span class="no">insect.brains.with.optic</span>, <span class="kw">function</span>(<span class="no">x</span>)
  <span class="fu">calculate_volume</span>(<span class="fu"><a href="https://rdrr.io/pkg/nat/man/subset.html">subset</a></span>(<span class="no">x</span>, <span class="no">x</span>$<span class="no">RegionList</span>[<span class="fu"><a href="https://rdrr.io/r/base/grep.html">grepl</a></span>(<span class="st">"^Lobula|^Medulla"</span>,<span class="no">x</span>$<span class="no">neuropil_full_names</span>)]))
)

<span class="co"># And out friend, Drosophila melanogaster</span>
<span class="no">insect.brains.with.optic</span><span class="kw">[[</span><span class="st">"Drosophila melanogaster"</span>]] <span class="kw">=</span> <span class="no">JFRC2NP.surf</span> <span class="co"># Got dropped out, as it does not have all the entries of a insectbraindb read brain</span>
<span class="no">insect.optic.volumes</span><span class="kw">[[</span><span class="st">"Drosophila melanogaster"</span>]] <span class="kw">=</span> <span class="fu">calculate_volume</span>(<span class="fu"><a href="https://rdrr.io/pkg/nat/man/subset.html">subset</a></span>(<span class="no">JFRC2NP.surf</span>, <span class="st">"LOP_|ME_|LO_"</span>), <span class="kw">alpha</span> <span class="kw">=</span> <span class="fl">3</span>)</pre></body></html></div>
<p>And let’s try plotting again with Ggplot2</p>
<div class="sourceCode" id="cb8"><html><body><pre class="r"><span class="co"># Assemble data.frame</span>
<span class="no">species.with.optic</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html">sapply</a></span>(<span class="no">insect.brains.with.optic</span>, <span class="kw">function</span>(<span class="no">x</span>) <span class="no">x</span>$<span class="no">common_name</span>)
<span class="no">sex.with.optic</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/unlist.html">unlist</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/lapply.html">sapply</a></span>(<span class="no">insect.brains.with.optic</span>, <span class="kw">function</span>(<span class="no">x</span>) <span class="no">x</span>$<span class="no">sex</span><span class="kw">[[</span><span class="fl">1</span>]]))
<span class="no">df3</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span>(<span class="kw">species</span> <span class="kw">=</span> <span class="no">species.with.optic</span>,
                <span class="kw">al.volume</span> <span class="kw">=</span> <span class="no">insect.al.volumes</span>[<span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span>(<span class="no">insect.optic.volumes</span>)],
                <span class="kw">optic.volume</span> <span class="kw">=</span> <span class="no">insect.optic.volumes</span>
                )

<span class="co"># Plot!</span>
<span class="kw pkg">ggplot2</span><span class="kw ns">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span>(<span class="no">df3</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span>(<span class="kw">x</span><span class="kw">=</span><span class="no">optic.volume</span>, <span class="kw">y</span><span class="kw">=</span><span class="no">al.volume</span>, <span class="kw">color</span> <span class="kw">=</span> <span class="no">species</span>)) +
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span>() +
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_smooth.html">geom_smooth</a></span>(<span class="kw">data</span> <span class="kw">=</span> <span class="no">df3</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span>(<span class="kw">x</span><span class="kw">=</span><span class="no">optic.volume</span>, <span class="kw">y</span><span class="kw">=</span><span class="no">al.volume</span>), <span class="kw">color</span>  <span class="kw">=</span><span class="st">"black"</span>, <span class="kw">method</span><span class="kw">=</span><span class="no">lm</span>, <span class="kw">se</span> <span class="kw">=</span> <span class="fl">FALSE</span>)+
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_classic</a></span>()

<span class="co"># Maybe we should normalise by total brain volume?</span>
<span class="no">df4</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span>(<span class="kw">species</span> <span class="kw">=</span> <span class="no">species.with.optic</span>,
                <span class="kw">al.norm.volume</span> <span class="kw">=</span> <span class="no">insect.al.volumes</span>[<span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span>(<span class="no">insect.optic.volumes</span>)]/<span class="no">insect.brain.volumes</span>[<span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span>(<span class="no">insect.optic.volumes</span>)],
                <span class="kw">optic.norm.volume</span> <span class="kw">=</span> <span class="no">insect.optic.volumes</span>/<span class="no">insect.brain.volumes</span>[<span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span>(<span class="no">insect.optic.volumes</span>)]
                )
<span class="kw pkg">ggplot2</span><span class="kw ns">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span>(<span class="no">df4</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span>(<span class="kw">x</span><span class="kw">=</span><span class="no">optic.norm.volume</span>, <span class="kw">y</span><span class="kw">=</span><span class="no">al.norm.volume</span>, <span class="kw">color</span> <span class="kw">=</span> <span class="no">species</span>)) +
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span>() +
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_smooth.html">geom_smooth</a></span>(<span class="kw">data</span> <span class="kw">=</span> <span class="no">df4</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span>(<span class="kw">x</span><span class="kw">=</span><span class="no">optic.norm.volume</span>, <span class="kw">y</span><span class="kw">=</span><span class="no">al.norm.volume</span>), <span class="kw">color</span> <span class="kw">=</span> <span class="st">"black"</span>, <span class="kw">method</span><span class="kw">=</span><span class="no">lm</span>, <span class="kw">se</span> <span class="kw">=</span> <span class="fl">FALSE</span>)+
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_classic</a></span>()</pre></body></html></div>
<p>Those budworms really skew things!</p>
<p>Of course, to be sure, we would need to control by reconstruction method and work harder to establish the exact cell type correspondences.</p>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by Alexander Bates.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.5.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
